%+------------------------------------------------------------------------+
%| Frame: Higher Courant Algebroid Definition
%| Author: Antonio miti
%+------------------------------------------------------------------------+

\documentclass[border=3pt,beamer,handout]{standalone}
\usepackage{tikz}
\usepackage{verbatim}
\usetikzlibrary{arrows,shapes}
\usepackage{tikz-cd}
\usepackage{amsmath}
\providecommand{\pairing}{\langle\cdot,\cdot\rangle}

\begin{document}
% For every picture that defines or uses external nodes, you'll have to
% apply the 'remember picture' style. To avoid some typing, we'll apply
% the style to all pictures.
\tikzstyle{every picture}+=[remember picture]

% By default all math in TikZ nodes are set in inline mode. Change this to
% displaystyle so that we don't get small fractions.
\everymath{\displaystyle}
\begin{minipage}[t]{\textwidth}
	\begin{minipage}[c]{0.4\textwidth}
			\begin{displaymath}
				 \big(
				 \tikz[baseline]{
				            \node[fill=blue!20,anchor=base] (t1)
				            {$ E$};
				        } 
					,
					 \tikz[baseline]{
				            \node[fill=green!20,anchor=base] (t2)
				            {$ \rho$};
					}
					,
					 \tikz[baseline]{
				            \node[fill=orange!20,anchor=base] (t3)
				            {$ \pairing_{\pm}$};
					}
					,
					 \tikz[baseline]{
				            \node[fill=red!20,anchor=base] (t4)
				            {$ \lbrack \cdot,\cdot \rbrack_\omega$};
					}					
				\big)
			\end{displaymath}	
	\end{minipage}
	\begin{minipage}[t]{0.6\textwidth}
		\tikzstyle{na} = [baseline=-.5ex]
		%
		\tikz[na] \node[scale=0.5,coordinate,fill=blue!20,draw,circle] (n1) {};		    
		   		 \onslide<1->{Vector bun. $E=TM\oplus (\wedge^{n-1}T^\ast M)$;}
		\\
		\tikz[na]\node [scale=0.5,coordinate,fill=green!20,draw,circle] (n2) {};	    
		    		\onslide<2->{anchor map 
						\begin{tikzcd}[baseline=(O.base),ampersand replacement=\&]
							|[alias=O]|\rho~:\&[-3em] E \ar[r]\& TM
							\\[-2em]
							\& \binom{x}{\alpha} \ar[r,mapsto] \& x
							~;
						\end{tikzcd}				    
			    }
	\end{minipage}

	\begin{minipage}[t]{\textwidth}
		\tikzstyle{na} = [baseline=-.5ex]
		\qquad\quad\tikz[na]\node [scale=0.5,coordinate,fill=orange!20,draw,circle] (n3) {};	    
		\onslide<3->{pairing
			\begin{tikzcd}[baseline=(O.base),ampersand replacement=\&]
				|[alias=O]|\pairing_{\pm}~:\&[-4em] E\otimes E \ar[r]\& \wedge^{n-2}T^\ast M
				\\[-2em]
				\& \binom{x_1}{\alpha_1}\otimes\binom{x_2}{\alpha_2} \ar[r,mapsto] \& 
				\frac{1}{2}(\iota_{x_1}\alpha_2 \pm \iota_{x_2}\alpha_1)
				~;
			\end{tikzcd}			
		}
		\\[.5em]
		\tikz[na]\node [scale=0.5,coordinate,fill=red!20,draw,circle] (n4) {};	    
		\onslide<4->{(higher) Courant bracket 
			\begin{displaymath}
				\begin{tikzcd}[ampersand replacement=\&]
					\lbrack\cdot,\cdot\rbrack_\omega~:\&[-3em] \Gamma(E)\otimes \Gamma(E) \ar[r]\& \Gamma(E)%\Omega^{n-2}(M)
					\\[-2em]
					\& \binom{x_1}{\alpha_1}\otimes\binom{x_2}{\alpha_2} \ar[r,mapsto]				
					\& \binom{[x_1,x_2]}{
						\mathcal{L}_{x_1}\alpha_2 - \mathcal{L}_{x_2}\alpha_1 - 
						d\left\langle \binom{x_1}{\alpha_1},\binom{x_2}{\alpha_2} \right \rangle_- +
						\iota_{x_1}\iota_{x_2} \omega
					}
					~.
				\end{tikzcd}		
			\end{displaymath}
		}	
	\end{minipage}
\end{minipage}
% Now it's time to draw some edges between the global nodes. Note that we
% have to apply the 'overlay' style.
\begin{tikzpicture}[overlay]
        \onslide<1->{\path[->,opacity=0.3] (n1) edge [bend right] (t1);}
        \onslide<2->{\path[->,opacity=0.3] (n2) edge [bend left] (t2);}
        \onslide<3->{\path[->,opacity=0.3] (n3) edge [bend left] (t3.south);}
        \onslide<4->{\path[->,opacity=0.3] (n4) edge [bend left] (t4.south);}
       % \path[->] (n3) edge [out=0, in=-90] (t3);
\end{tikzpicture}

\end{document}