%+------------------------------------------------------------------------+
%| Diagram with Overlays: Prequantum map factorization - symplectic case
%| Author: Antonio miti
%+------------------------------------------------------------------------+


\documentclass[beamer,handout]{standalone}
\usepackage{tikz-cd}
\usepackage{mathtools}
\usepackage{amsfonts}
\usetikzlibrary{decorations.pathmorphing}
\usetikzlibrary{cd, fit}

	%Credit: https://tex.stackexchange.com/questions/99119/beamer-problematic-use-of-visible-and-only-in-combination-with-tikz-to-draw-a
  \tikzset{
    invisible/.style={opacity=0},
    visible on/.style={alt=#1{}{invisible}},
    alt/.code args={<#1>#2#3}{%
      \alt<#1>{\pgfkeysalso{#2}}{\pgfkeysalso{#3}} % \pgfkeysalso doesn't change the path
    },
  }

\definecolor{grey}{rgb}{0.30, 0.30, 0.30}

\begin{document}
	%
	\begin{tikzcd}[column sep= small,row sep=small,
		]	
		%
		|[visible on=<1->]| C^\infty(M)_\omega
		\ar[dr,visible on=<2->,sloped,"\sim","\textrm{Preq}_\theta"']
		\ar[rrrr,dashed,"\Psi_\omega"]
		&&&&
		\Gamma(TM\oplus\mathbb{R})_\omega
		\\
		& |[visible on=<2->]| Q(P,\theta) \ar[r,visible on=<3->,hook] 
		& |[visible on=<3->]|\mathfrak{X}(P)^{S^1} \ar[r,visible on=<4->,equal]
		& |[visible on=<4->]|\Gamma(\textrm{At}(P)) \ar[ur,visible on=<5->,"\sim",sloped]		
 	\end{tikzcd}	
\end{document}

	