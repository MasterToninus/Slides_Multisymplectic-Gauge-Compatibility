%+------------------------------------------------------------------------+
%| Diagram with Overlays: Definition of Lie n-algebra of observables in a diagram
%| Author: Antonio miti
%+------------------------------------------------------------------------+


\documentclass[beamer]{standalone}
\usepackage{tikz-cd}
\usetikzlibrary{shapes.geometric,fit} %Ellissi attorno ai nodi
\usepackage{mathtools}
\usepackage{amsfonts}
\tikzset{%
    symbol/.style={%
        ,draw=none
        ,every to/.append style={%
            edge node={node [sloped, allow upside down, auto=false]{$#1$}}}
    }
}
\tikzset{
   dashrect/.style={,rectangle,draw,dashed,inner sep=0pt,black!60!green,fit={#1}}
}
  \tikzset{
    invisible/.style={opacity=0},
    visible on/.style={alt=#1{}{invisible}},
    alt/.code args={<#1>#2#3}{%
      \alt<#1>{\pgfkeysalso{#2}}{\pgfkeysalso{#3}} % \pgfkeysalso doesn't change the path
    },
  }


\begin{document}
%\begin{standaloneframe}[fragile]
\begin{tikzcd}[column sep= small,row sep=small]
	0 \ar[r,] &[-.5em]
	L^{1-n}\ar[symbol=\coloneqq,d] \ar[r,"\{\cdot\}_1"] &
	\ldots \ar[r,"\{\cdot\}_1"] &
	L^{2-k} \ar[symbol=\coloneqq,d] \ar[r,"\{\cdot\}_1"] &
	\ldots \ar[r,"\{\cdot\}_1"] &
	L^{-1}\ar[symbol=\coloneqq,d] \ar[r,"\{\cdot\}_1"] & 
	L^0\ar[symbol=\coloneqq,d]\ar[r] &[-1.75em]
	0 
	\\
	%
	& 
	|[visible on=<2->]|\Omega^0(M) \ar["d",r,visible on=<2->] &
	|[visible on=<2->]|\ldots \ar["d",r,visible on=<2->] &
	|[visible on=<2->]|\only<1-2>{\Omega^{n+1-k}(M)}\only<3->{\phantom{\Omega^{n+1-k}(M)}} \ar["d",r,visible on=<2->] &
	|[visible on=<2->]|\ldots\ar["d",r,visible on=<2->] &
	|[visible on=<2->]|\Omega^{n-2}(M) \ar["d",r,visible on=<2->] &
	|[visible on=<2->]|\only<1-2>{\Omega^{n-1}_{\textrm{Ham}}(M,\omega)}\only<3->{\phantom{\Omega^{n-1}_{\textrm{Ham}}(M,\omega)} 
	\arrow[lll,black!60!green,to path={ node[rectangle,dashed,draw]{$\Omega^{n-1}_{\textrm{Ham}}(M,\omega)$} -- +(0,-4ex) -| node[draw,ellipse,fill=white,scale=0.65,pos=0.25]{$\{\cdot,\ldots,\cdot\}_k$}(\tikztotarget)node[rectangle,dashed,draw]{$\Omega^{n+1-k}(M)$}}]}
	&
	\\
\end{tikzcd}
%\end{standaloneframe}
\end{document}
