%+------------------------------------------------------------------------+
%| Diagram: Kiddo Diagram - k-plectic case
%| Author: Antonio miti
%+------------------------------------------------------------------------+


\documentclass[beamer,handout]{standalone}
\usepackage{tikz-cd}
\usepackage{mathtools}
\usepackage{amsfonts}
\usetikzlibrary{decorations.pathmorphing}
\usetikzlibrary{cd, fit}

	%Credit: https://tex.stackexchange.com/questions/99119/beamer-problematic-use-of-visible-and-only-in-combination-with-tikz-to-draw-a
  \tikzset{
    invisible/.style={opacity=0},
    visible on/.style={alt=#1{}{invisible}},
    alt/.code args={<#1>#2#3}{%
      \alt<#1>{\pgfkeysalso{#2}}{\pgfkeysalso{#3}} % \pgfkeysalso doesn't change the path
    },
  }
\definecolor{grey}{rgb}{0.30, 0.30, 0.30}


\begin{document}
	\begin{tikzcd}[
		column sep= small,row sep=small,
		/tikz/execute at end picture={
    		\node (large) [rectangle,dashed, draw, fit=(A1) (A2),label=below:{\scriptsize$L_\infty$-algebras cat.}] {};
  		}]		
		&[-3em] |[visible on=<1>]| \color{grey}{(E^n,\rho,\langle\cdot,\cdot\rangle,[\cdot,\cdot]_\omega)}
		\ar[dl,grey,visible on=<1>,rightsquigarrow]
		\ar[ddd,grey,visible on=<1>,sloped,"\cong","\text{B-transf.}"']
%
	\\
%
		|[visible on=<1->,alias=A1]| L_{\infty}\big(E^n,\omega\big)
		\ar[d,sloped,line width=0.8pt,color=green!60!black,"\cong", visible on=<4->]
		&
%		 
	\\[1.5em]
%
		|[visible on=<1->,alias=A2]| L_{\infty}\big(E^n,{\tilde{\omega}}\big)
		&
%		
	\\
%	
		& |[visible on=<1>]| \color{grey}{(E^n,[\cdot,\cdot]_{\tilde{\omega}})}
		\ar[ul,grey,visible on=<1>,rightsquigarrow]
 	\end{tikzcd}	







\end{document}


		\only<6->{(M,\tilde{\omega}) \ar[rrrr,rightsquigarrow,"\text{}"]
		\ar[urr,rightsquigarrow,"\text{observables}"] }
		& \phantom{\big(} & & 
		& \only<6->{(TM\oplus\bigwedge^{k-1}T^\ast M,\rho,\langle\cdot,\cdot\rangle,[\cdot,\cdot]_{\tilde{\omega}}) \ar[ul,rightsquigarrow] }
 	\end{tikzcd}	