%+------------------------------------------------------------------------+
%| Diagram: Kiddo Diagram - k-plectic case
%| Author: Antonio miti
%+------------------------------------------------------------------------+


\documentclass[beamer,handout]{standalone}
\usepackage{tikz-cd}
\usetikzlibrary{cd, fit}
\usepackage{mathtools}
\usepackage{amsfonts}
\usetikzlibrary{decorations.pathmorphing}
	%Credit: https://tex.stackexchange.com/questions/99119/beamer-problematic-use-of-visible-and-only-in-combination-with-tikz-to-draw-a
  \tikzset{
    invisible/.style={opacity=0},
    visible on/.style={alt=#1{}{invisible}},
    alt/.code args={<#1>#2#3}{%
      \alt<#1>{\pgfkeysalso{#2}}{\pgfkeysalso{#3}} % \pgfkeysalso doesn't change the path
    },
  }


\begin{document}
	\begin{tikzcd}[column sep= small,row sep=small,
		/tikz/execute at end picture={
    		\node (large) [rectangle,dashed, draw, fit=(A1) (A2),label=below:{\scriptsize Lie algebras cat.}] {};
  		}]	
		(M,\omega) 
		\ar[dr,visible on=<1->,rightsquigarrow,"\text{observables}"]
		\ar[rrr,visible on=<2->,rightsquigarrow,"\text{twisted standard Lie algebroid}"]
		& &[4em] &[-3em] 
		|[visible on=<2->]| (TM \oplus \mathbb{R}_M,\rho, [\cdot,\cdot]_\omega)
		\ar[dl,visible on=<3->,rightsquigarrow]
%
	\\[1em]
%
		& 
		|[visible on=<1->,alias=A1]| \big(C^\infty(M),\lbrace\cdot,\cdot\rbrace_\omega\big)
		\ar[r,visible on=<4->,dashed,hook,line width=0.8pt,color=blue!60!black,"\Psi"]
		& |[visible on=<3->,alias=A2]| \big(\Gamma(TM\oplus \mathbb{R}),[\cdot,\cdot]_\omega\big)
		&
 	\end{tikzcd}	



\end{document}

